<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YouTube Clone</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Arial, sans-serif;
    }
    body {
      display: flex;
      min-height: 100vh;
    }
    .sidebar {
      width: 240px;
      background: #f8f8f8;
      border-right: 1px solid #ddd;
      padding: 10px;
      overflow-y: auto;
    }
    .sidebar h3, .sidebar ul {
      margin-bottom: 10px;
    }
    .sidebar ul {
      list-style: none;
    }
    .sidebar ul li {
      padding: 8px;
      cursor: pointer;
    }
    .sidebar ul li:hover {
      background: #ddd;
    }
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background: #fff;
      border-bottom: 1px solid #ddd;
    }
    .search {
      flex: 1;
      margin: 0 20px;
    }
    .search input {
      width: 100%;
      padding: 6px 10px;
    }
    .video-upload {
      padding: 10px;
    }
    .video-upload input, .video-upload textarea, .video-upload select {
      display: block;
      margin-bottom: 10px;
      width: 100%;
      padding: 6px;
    }
    .video-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 15px;
      padding: 20px;
    }
    .video-card {
      border: 1px solid #ddd;
      padding: 10px;
    }
    .video-card video {
      width: 100%;
      cursor: pointer;
    }
    .video-type-heading {
      font-size: 20px;
      margin-top: 20px;
      margin-bottom: 10px;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h3>Home</h3>
    <ul>
      <li>Shorts</li>
      <li>Subscriptions</li>
      <li>You</li>
      <li>History</li>
      <li>Playlists</li>
      <li>Your videos</li>
      <li>Watch Later</li>
      <li>Liked videos</li>
    </ul>
  </div>
  <div class="main">
    <div class="topbar">
      <span><i class="fab fa-youtube"></i> YouTube Clone</span>
      <div class="search">
        <input type="text" placeholder="Search" />
      </div>
      <div>
        <button onclick="document.getElementById('uploadForm').style.display='block'">Upload Video</button>
        <i class="fas fa-bell"></i>
        <i class="fas fa-user-circle"></i>
      </div>
    </div>

    <div id="uploadForm" class="video-upload" style="display:none">
      <input type="file" id="videoFile" accept="video/*" />
      <input type="text" id="videoTitle" placeholder="Video Title" />
      <textarea id="videoDesc" placeholder="Video Description"></textarea>
      <label for="videoType">Video Type:</label>
      <select id="videoType">
        <option value="regular">Regular Video</option>
        <option value="short">Short</option>
      </select>
      <button onclick="uploadVideo()">Upload</button>
    </div>

    <div id="videoContainer">
      <div class="video-type-heading">Videos</div>
      <div id="videoGrid" class="video-grid"></div>

      <div class="video-type-heading">Shorts</div>
      <div id="shortGrid" class="video-grid"></div>
    </div>
  </div>

  <script>
    let videos = JSON.parse(localStorage.getItem('videos')) || [];

    function uploadVideo() {
      const file = document.getElementById('videoFile').files[0];
      const title = document.getElementById('videoTitle').value;
      const description = document.getElementById('videoDesc').value;

      if (!file || !title || !description) return alert('Please fill out all fields.');

      const videoElement = document.createElement('video');
      const videoUrl = URL.createObjectURL(file);

      videoElement.onloadedmetadata = function () {
        const width = videoElement.videoWidth;
        const height = videoElement.videoHeight;

        // Determine if the video is a Short based on resolution
        const isShort = (width === 1080 && height === 1920);

        // Create a new video object
        const newVideo = {
          "videoid": 'vid_' + Date.now(),
          "title": title,
          "description": description,
          "mp4": videoUrl, // Store the video URL temporarily
          "dateuploaded": new Date().toLocaleString(),
          "views": 0,
          "channel": "You",
          "type": isShort ? "short" : "regular" // Classify as short or regular based on resolution
        };

        // Push the new video into the videos array
        videos.push(newVideo);

        // Save the updated array in localStorage
        saveVideos();
        
        // Display the new video on the page
        displayVideos();
        
        // Hide the upload form
        document.getElementById('uploadForm').style.display = 'none';
      };

      videoElement.src = videoUrl; // Set the video source to trigger metadata load
    }

    function displayVideos() {
      const videoContainer = document.getElementById('videoGrid');
      const shortContainer = document.getElementById('shortGrid');
      
      videoContainer.innerHTML = ''; // Clear the video container
      shortContainer.innerHTML = ''; // Clear the shorts container

      // Loop through all the videos and display them based on type
      videos.forEach((v, index) => {
        const videoElement = `
          <div class="video-card">
            <video onclick="viewVideo(${index})" src="${v.mp4}" controls></video>
            <h4>${v.title}</h4>
            <p>${v.channel} • ${v.views} views • ${v.dateuploaded}</p>
            <p>${v.description}</p>
          </div>
        `;

        // Append to the correct container based on video type
        if (v.type === 'regular') {
          videoContainer.innerHTML += videoElement;
        } else {
          shortContainer.innerHTML += videoElement;
        }
      });
    }

    function viewVideo(index) {
      const video = videos[index];

      // Increment views only once for each user
      if (!video.viewed) {
        video.views++;
        video.viewed = true;
        
        // Save updated views to localStorage
        saveVideos();
        
        // Re-render the video list
        displayVideos();
      }
    }

    function saveVideos() {
      localStorage.setItem('videos', JSON.stringify(videos)); // Save videos array to localStorage
    }

    displayVideos(); // Initially load the videos on page load
  </script>
</body>
</html>
