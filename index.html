<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YouTube Clone</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Arial, sans-serif;
    }
    body {
      display: flex;
      min-height: 100vh;
    }
    .sidebar {
      width: 240px;
      background: #f8f8f8;
      border-right: 1px solid #ddd;
      padding: 10px;
      overflow-y: auto;
    }
    .sidebar h3, .sidebar ul {
      margin-bottom: 10px;
    }
    .sidebar ul {
      list-style: none;
    }
    .sidebar ul li {
      padding: 8px;
      cursor: pointer;
    }
    .sidebar ul li:hover {
      background: #ddd;
    }
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background: #fff;
      border-bottom: 1px solid #ddd;
    }
    .search {
      flex: 1;
      margin: 0 20px;
    }
    .search input {
      width: 100%;
      padding: 6px 10px;
    }
    .video-upload {
      padding: 10px;
    }
    .video-upload input, .video-upload textarea, .video-upload select {
      display: block;
      margin-bottom: 10px;
      width: 100%;
      padding: 6px;
    }
    .video-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 15px;
      padding: 20px;
    }
    .video-card {
      border: 1px solid #ddd;
      padding: 10px;
    }
    .video-card video {
      width: 100%;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h3>Home</h3>
    <ul>
      <li>Shorts</li>
      <li>Subscriptions</li>
      <li>You</li>
      <li>History</li>
      <li>Playlists</li>
      <li>Your videos</li>
      <li>Watch Later</li>
      <li>Liked videos</li>
    </ul>
  </div>
  <div class="main">
    <div class="topbar">
      <span><i class="fab fa-youtube"></i> YouTube Clone</span>
      <div class="search">
        <input type="text" placeholder="Search" />
      </div>
      <div>
        <button onclick="document.getElementById('uploadForm').style.display='block'">Upload Video</button>
        <i class="fas fa-bell"></i>
        <i class="fas fa-user-circle"></i>
      </div>
    </div>

    <div id="uploadForm" class="video-upload" style="display:none">
      <input type="file" id="videoFile" accept="video/*" />
      <input type="text" id="videoTitle" placeholder="Video Title" />
      <textarea id="videoDesc" placeholder="Video Description"></textarea>
      <label for="videoType">Video Type:</label>
      <select id="videoType">
        <option value="regular">Regular Video</option>
        <option value="short">Short</option>
      </select>
      <button onclick="uploadVideo()">Upload</button>
    </div>

    <div id="videoContainer" class="video-grid"></div>
  </div>

  <script>
    let videos = JSON.parse(localStorage.getItem('videos')) || [];

    function uploadVideo() {
      const file = document.getElementById('videoFile').files[0];
      const title = document.getElementById('videoTitle').value;
      const description = document.getElementById('videoDesc').value;
      const type = document.getElementById('videoType').value; // Get the video type (regular or short)

      if (!file || !title || !description) return alert('Please fill out all fields.');

      // Convert the video file to a data URL
      const reader = new FileReader();
      reader.onload = function(e) {
        const newVideo = {
          "videoid": 'vid_' + Date.now(),
          "title": title,
          "description": description,
          "mp4": e.target.result, // Store video data as base64
          "dateuploaded": new Date().toLocaleString(),
          "views": 0,
          "channel": "You",
          "type": type // Store the type of the video (short or regular)
        };

        // Push the new video into the videos array
        videos.push(newVideo);

        // Save the updated array in localStorage
        saveVideos();
        
        // Display the new video on the page
        displayVideos();
        
        // Hide the upload form
        document.getElementById('uploadForm').style.display = 'none';
      };
      reader.readAsDataURL(file); // Read the file as base64
    }

    function displayVideos() {
      const container = document.getElementById('videoContainer');
      container.innerHTML = ''; // Clear the container first

      // Loop through all the videos and display them
      videos.forEach((v, index) => {
        // If the video is a "Short", style it differently
        const videoTypeClass = v.type === 'short' ? 'video-short' : '';

        container.innerHTML += `
          <div class="video-card ${videoTypeClass}">
            <video onclick="viewVideo(${index})" src="${v.mp4}" controls></video>
            <h4>${v.title}</h4>
            <p>${v.channel} • ${v.views} views • ${v.dateuploaded}</p>
            <p>${v.description}</p>
          </div>
        `;
      });
    }

    function viewVideo(index) {
      const video = videos[index];

      // Increment views only once for each user
      if (!video.viewed) {
        video.views++;
        video.viewed = true;
        
        // Save updated views to localStorage
        saveVideos();
        
        // Re-render the video list
        displayVideos();
      }
    }

    function saveVideos() {
      localStorage.setItem('videos', JSON.stringify(videos)); // Save videos array to localStorage
    }

    displayVideos(); // Initially load the videos on page load
  </script>
</body>
</html>
